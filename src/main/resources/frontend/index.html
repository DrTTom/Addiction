<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dependency Graph</title>
  <script src="vis.min.js"></script>
  <link href="vis.min.css" rel="stylesheet" type="text/css" />
  <style>
    body {
    font-family: Arial, Helvetica, sans-serif;
    }
    #mynetwork {
      width: 650px;
      height: 650px;
      border: 1px solid lightgray;
      float: left;
      margin-right: 10px;
      }
  </style>
</head>
<body>
<h1>Dependency graph of project TODO</h1>
<div id="mynetwork"></div>
<div id="detailInfo">
<h2>Graph</h2>
reset nodes to level <button>class</button> <button>package</button> <button>container</button><br/>
show <button>all</button> <button>cycles only</button> <button>needed by selection</button> <button>using selection</button>

<h2>Selected Element</h2>
<div id="description">Click element to select</div>
</div>
<button onClick="changeListMode('EXPANDED')">expand</button>
<button onClick="changeListMode('COLLAPSE_PARENT')">collapse into parent container</button>
<script>
get("http://localhost:4567/view", showGraph);

function get(url, callBack) {
    var req = new XMLHttpRequest();
    req.open('GET', url, true);
    req.send();
    req.onreadystatechange = function(e) {
        if (req.readyState == 4) {
            callBack(req.responseText);
        }
    }
}

function showGraph(responseText) {
    var response = JSON.parse(responseText);
    var nodes = new vis.DataSet(response.nodes);
    var edges = new vis.DataSet(response.edges);

    var container = document.getElementById('mynetwork');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {};
    var network = new vis.Network(container, data, options);

    network.on("stabilized", function(params) {
        network.setOptions({
            physics: false
        });
    });

    network.on("click", function(params) {
    	selectedNode='';
        params.event = "[original event]";
        if (params.nodes.length == 1) {
            getNodeInfo(params.nodes[0]);
        } else if (params.edges.length == 1) {
            getArcInfo(params.edges[0]);
        } else document.getElementById('description').innerHTML = "nothing selected";
    });
}

var selectedNode ='';

function getNodeInfo(id) {
    get("http://localhost:4567/view/node/" + id, function(e) {
    var nodeInfo= JSON.parse(e);
    var value = '<h3>'+nodeInfo.type+' '+nodeInfo.name+'</h3>';
    if (typeof nodeInfo.resourceType!='undefined')
    	{
    	value=value+ "found in: "+nodeInfo.resourceType+" "+ nodeInfo.resourceName +"<br>";
    	}
    if (nodeInfo.type != 'class'){
    value=value+ "represents "+nodeInfo.numberContainedClasses +" classes<br>";
    }
    value=value+"current reference is: "+id;
    selectedNode=id
    document.getElementById('description').innerHTML = value;
    });
}

function changeListMode(mode)
{
	if (selectedNode!='')
		{
		get("http://localhost:4567/view/node/"+selectedNode+"/listmode/"+mode, showGraph);
		}
	}

function getArcInfo(id) {
    get("http://localhost:4567/view/arc/" + id, function(e) {
    var arcInfo= JSON.parse(e);
    var description='<h3>'+ arcInfo.from.name+ ' depends on ' + arcInfo.to.name +
    '</h3> Reason: <table>';
    arcInfo.reason.forEach( function (pair){ description=description+'<tr><td>'+pair.first+'</td><td> depends on </td><td>'+pair.second+'</td></tr>'});
    
    document.getElementById('description').innerHTML =  description+'</table>';
   });
}
</script>

</body>
</html>
